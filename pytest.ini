[pytest]
pythonpath = . src
norecursedirs = .hypothesis tmp
markers = 
    unit: marks tests as unit tests (fast, isolated)
    integration: marks tests as integration tests (moderate speed)
    system: marks tests as system tests (slow, end-to-end)
    fast: marks tests as fast-running tests
    slow: marks tests as slow-running tests
    network: marks tests that require network access
    universe: marks tests related to universe/holdings data
    strategy: marks tests related to strategy functionality
    timing: marks tests related to timing framework
    data_sources: marks tests related to data source functionality
    optimization: marks tests related to optimization functionality
    monte_carlo: marks tests related to Monte Carlo functionality
    reporting: marks tests related to reporting functionality
addopts = 
    --durations=25
    --durations-min=1.0
    -v
    --tb=short
    --benchmark-disable
    # profiling plugin disabled by default due to instability in some environments
    -m "not slow"
filterwarnings =
    # Ignore warnings from external libraries (e.g., anything in .venv / site-packages)
    ignore::Warning
    # Keep existing specific ignore rules for third-party packages
    ignore::DeprecationWarning:pandas_datareader.*
    ignore:distutils Version classes are deprecated.*:DeprecationWarning:pandas_datareader.*
    # Ignore deprecation warnings from setuptools/distutils version parsing used by pandas_datareader
    ignore:distutils Version classes are deprecated.*:DeprecationWarning:setuptools._distutils.*
    ignore::DeprecationWarning:setuptools._distutils.*
    # Show warnings originating from the project codebase, but limit noisy ones
    # to a single occurrence per test run to avoid overwhelming output.
    once::RuntimeWarning:portfolio_backtester.reporting.performance_metrics
    # Ignore repeated precision loss warnings from performance_metrics (intentional)
    ignore:Precision loss occurred in moment calculation due to catastrophic cancellation.*:RuntimeWarning:portfolio_backtester.reporting.performance_metrics
    default::Warning:portfolio_backtester.*
    default::Warning:tests.*
    # Suppress deprecation-like pandas downcasting guidance coming from our utils where we've adopted the future behavior
    ignore:Downcasting object dtype arrays on .*:FutureWarning:portfolio_backtester.utils.price_data_utils