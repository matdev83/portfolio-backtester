
============================================================
Portfolio Backtester Test Suite
============================================================
Session started at: 2025-08-11 19:01:48
Python version: 3.10.11 (tags/v3.10.11:7d4cc5a, Apr  5 2023, 00:38:17) [MSC v.1929 64 bit (AMD64)]
Pandas version: 2.3.1
NumPy version: 2.2.6
============================================================
============================= test session starts =============================
platform win32 -- Python 3.10.11, pytest-8.4.1, pluggy-1.6.0
benchmark: 5.1.0 (defaults: timer=time.perf_counter disable_gc=False min_rounds=5 min_time=0.000005 max_time=1.0 calibration_precision=10 warmup=False warmup_iterations=100000)
rootdir: C:\Users\Mateusz\source\repos\portfolio-backtester
configfile: pytest.ini
plugins: anyio-4.9.0, benchmark-5.1.0, cov-6.2.1, profiling-1.8.1
collected 1395 items / 96 deselected / 2 skipped / 1299 selected

tests\integration\backtester\test_simple_integration.py .......          [  0%]
tests\integration\optimization\test_performance_regression.py ss....     [  1%]
tests\integration\optimization\test_separation_of_concerns.py ss........ [  1%]
..                                                                       [  1%]
tests\integration\strategies\test_dummy_meta_strategy_integration.py .   [  2%]
tests\integration\strategies\test_dummy_strategy_integration.py .        [  2%]
tests\integration\strategies\test_meta_strategy_integration.py ....      [  2%]
tests\integration\test_combined_stop_loss_take_profit.py ..              [  2%]
tests\integration\test_configurable_universes.py ..........              [  3%]
tests\integration\test_daily_evaluation_integration.py ......            [  3%]
tests\integration\test_intramonth_strategy_integration.py ..FF.......    [  4%]
tests\integration\test_schedule_independent_stop_loss.py F               [  4%]
tests\integration\test_study_name_conflicts.py ....                      [  5%]
tests\integration\test_timing_dependencies.py .........                  [  5%]
tests\integration\test_universe_configuration_integration.py ........    [  6%]
tests\strategies\test_intramonth_seasonal_strategy.py ....               [  6%]
tests\test_final_directional_metrics.py .                                [  6%]
tests\test_universe_check.py ..                                          [  6%]
tests\unit\backtester\test_constraint_handler.py ....                    [  7%]
tests\unit\backtester_logic\test_solid_refactoring.py .................. [  8%]
...                                                                      [  8%]
tests\unit\backtesting\test_combined_risk_window_evaluator.py .......    [  9%]
tests\unit\backtesting\test_portfolio_logic_returns.py .                 [  9%]
tests\unit\backtesting\test_position_tracker.py .............            [ 10%]
tests\unit\backtesting\test_results.py ..............                    [ 11%]
tests\unit\backtesting\test_strategy_backtester.py ................      [ 12%]
tests\unit\backtesting\test_strategy_backtester_math.py ...              [ 12%]
tests\unit\backtesting\test_window_evaluator.py ...                      [ 13%]
tests\unit\backtesting\test_window_evaluator_stop_loss_integration.py .. [ 13%]
FF..FF.                                                                  [ 13%]
tests\unit\core\test_backtester_cli.py .                                 [ 13%]
tests\unit\core\test_comparison_utilities.py ....                        [ 14%]
tests\unit\core\test_config_loader.py ...                                [ 14%]
tests\unit\core\test_config_loader_optimizer_merge.py .                  [ 14%]
tests\unit\core\test_core.py .                                           [ 14%]
tests\unit\core\test_data_cache.py ........                              [ 15%]
tests\unit\core\test_merge_optimizer_config.py ..                        [ 15%]
tests\unit\core\test_metrics.py .                                        [ 15%]
tests\unit\core\test_optimized_data_generator.py ...............         [ 16%]
tests\unit\core\test_transaction_costs.py .                              [ 16%]
tests\unit\core\test_yaml_error_handling.py ..............               [ 17%]
tests\unit\cusip_mapping\test_cusip_mapping_db_dip.py ..........         [ 18%]
tests\unit\data_integrity\test_spy_holdings_no_gaps.py .                 [ 18%]
tests\unit\data_sources\test_consolidated_data_validation.py ....        [ 18%]
tests\unit\data_sources\test_data_sanity_check.py ..                     [ 19%]
tests\unit\data_sources\test_hybrid_data_source.py .................     [ 20%]
tests\unit\interfaces\test_database_loader_interface.py ................ [ 21%]
........                                                                 [ 22%]
tests\unit\interfaces\test_date_normalizer_interface.py ................ [ 23%]
....                                                                     [ 23%]
tests\unit\interfaces\test_price_data_polymorphism.py .................. [ 25%]
.........                                                                [ 25%]
tests\unit\monte_carlo\test_synthetic_data_generator.py ...              [ 26%]
tests\unit\optimization\test_advanced_crossover.py ......                [ 26%]
tests\unit\optimization\test_enhanced_evaluator.py ..............        [ 27%]
tests\unit\optimization\test_evaluator.py ...........                    [ 28%]
tests\unit\optimization\test_evaluator_aggregation.py ...                [ 28%]
tests\unit\optimization\test_genetic_parameter_generator.py ............ [ 29%]
.....................                                                    [ 31%]
tests\unit\optimization\test_optuna_parameter_generator.py .....         [ 31%]
tests\unit\optimization\test_orchestrator.py ..............              [ 32%]
tests\unit\optimization\test_parallel_optimization_enhanced.py ......... [ 33%]
..                                                                       [ 33%]
tests\unit\optimization\test_parameter_generator_interface.py .......... [ 34%]
.................                                                        [ 35%]
tests\unit\optimization\test_study_context_management.py ....            [ 35%]
tests\unit\optimization\test_study_utils.py ......                       [ 36%]
tests\unit\optimization\test_wfo_robustness.py .........                 [ 37%]
tests\unit\optimization\test_wfo_window.py ...........                   [ 37%]
tests\unit\optimizer\test_dummy_strategy_optimizer.py .                  [ 38%]
tests\unit\portfolio\test_position_sizer.py .........                    [ 38%]
tests\unit\portfolio\test_position_sizer_utils.py .....                  [ 39%]
tests\unit\registration\test_registration_components.py ................ [ 40%]
............                                                             [ 41%]
tests\unit\reporting\test_performance_metrics.py .......                 [ 41%]
tests\unit\risk_management\test_atr_service_caching.py ....              [ 42%]
tests\unit\risk_management\test_daily_stop_loss_monitor.py ............. [ 43%]
.....                                                                    [ 43%]
tests\unit\risk_management\test_daily_take_profit_monitor.py ........... [ 44%]
..........                                                               [ 45%]
tests\unit\risk_management\test_take_profit_handlers.py ................ [ 46%]
....                                                                     [ 46%]
tests\unit\risk_off_signals\test_risk_off_signals.py .............       [ 47%]
tests\unit\strategies\meta\test_base_meta_strategy.py .........          [ 48%]
tests\unit\strategies\meta\test_simple_meta_strategy.py ....             [ 48%]
tests\unit\strategies\meta\test_trade_aggregation.py ........            [ 49%]
tests\unit\strategies\meta\test_trade_aggregator.py ............         [ 50%]
tests\unit\strategies\meta\test_trade_aggregator_edge.py ..              [ 50%]
tests\unit\strategies\meta\test_trade_interceptor.py .........           [ 51%]
tests\unit\strategies\meta\test_trade_record.py ................         [ 52%]
tests\unit\strategies\test_intramonth_seasonal_strategy.py ....          [ 52%]
tests\unit\strategies\test_momentum_strategies.py .................      [ 53%]
tests\unit\strategies\test_strategy_factory.py ......                    [ 54%]
tests\unit\strategies\test_strategy_initialization.py ......             [ 54%]
tests\unit\strategies\test_universe_configuration.py ................... [ 56%]
                                                                         [ 56%]
tests\unit\test_attribute_accessor_dip.py .............................  [ 58%]
tests\unit\test_config_polymorphism.py .......................           [ 60%]
tests\unit\test_detailed_commissions_fastpath_equivalence.py ...         [ 60%]
tests\unit\test_dynamic_scenario_validator.py .......                    [ 61%]
tests\unit\test_enhanced_diagnostic_validator.py ........                [ 61%]
tests\unit\test_feature_flags.py ...............                         [ 62%]
tests\unit\test_ndarray_portfolio_kernel.py ..                           [ 62%]
tests\unit\test_optimization_path_equivalence.py ...................     [ 64%]
tests\unit\test_parallel_wfo_dip.py ...............                      [ 65%]
tests\unit\test_strategy_config_cross_validator.py ........              [ 66%]
tests\unit\test_strategy_config_validator.py .......                     [ 66%]
tests\unit\test_timing_controller_dip.py ........                        [ 67%]
tests\unit\test_validator_interfaces_dip.py ............................ [ 69%]
..............                                                           [ 70%]
tests\unit\timing\test_builtin_custom_controllers.py ....                [ 70%]
tests\unit\timing\test_config_schema_refactored.py ...........           [ 71%]
tests\unit\timing\test_config_validator.py ..........................    [ 73%]
tests\unit\timing\test_consolidated_compatibility.py .F...               [ 74%]
tests\unit\timing\test_custom_timing_registry.py ..........              [ 74%]
tests\unit\timing\test_enhanced_timing_state.py .......                  [ 75%]
tests\unit\timing\test_performance_comparison.py ...                     [ 75%]
tests\unit\timing\test_position_info.py ....                             [ 75%]
tests\unit\timing\test_signal_based_timing.py ......................     [ 77%]
tests\unit\timing\test_state_debug_utilities.py ....                     [ 77%]
tests\unit\timing\test_state_edge_cases.py ......                        [ 78%]
tests\unit\timing\test_state_persistence.py ...                          [ 78%]
tests\unit\timing\test_time_based_timing.py .F.FF.F....F.FF...F..        [ 80%]
tests\unit\timing\test_timing_controller.py .......                      [ 80%]
tests\unit\timing\test_timing_framework_integration.py ..                [ 80%]
tests\unit\timing\test_timing_logger.py .........                        [ 81%]
tests\unit\timing\test_timing_logger_refactored.py ............          [ 82%]
tests\unit\timing\test_timing_state_refactored.py ................       [ 83%]
tests\unit\timing\test_yaml_config_schema.py ...............             [ 84%]
tests\unit\trading\test_unified_commission_calculator.py .........       [ 85%]
tests\unit\universe\test_spy_universe.py .....                           [ 86%]
tests\unit\universe\test_universe_loader.py ............................ [ 88%]
                                                                         [ 88%]
tests\unit\utils\test_array_converter_polymorphism.py .................. [ 89%]
...............                                                          [ 90%]
tests\unit\utils\test_enhanced_window_generation.py ..............       [ 91%]
tests\unit\utils\test_price_data_utils.py ....                           [ 92%]
tests\unit\utils\test_scalar_extractor_polymorphism.py ................. [ 93%]
.................                                                        [ 94%]
tests\unit\utils\test_strategy_resolver_polymorphism.py ................ [ 95%]
......................                                                   [ 97%]
tests\unit\utils\test_timeout_manager.py .....                           [ 98%]
tests\unit\utils\test_utils_polymorphic_integration.py ................. [ 99%]
.                                                                        [ 99%]
tests\validation\test_meta_strategy_accuracy.py .......                  [100%]
============================================================
Session finished at: 2025-08-11 19:02:48
Exit status: 1
Cache performance:
  - LRU cache hits: 0
  - LRU cache misses: 0
  - Lazy cache entries: 0
============================================================


============================== warnings summary ===============================
tests/integration/test_timing_dependencies.py: 1 warning
tests/unit/timing/test_performance_comparison.py: 2 warnings
tests/unit/timing/test_time_based_timing.py: 10 warnings
  C:\Users\Mateusz\source\repos\portfolio-backtester\src\portfolio_backtester\timing\time_based_timing.py:39: FutureWarning: 'M' is deprecated and will be removed in a future version, please use 'ME' instead.
    rebalance_dates = pd.bdate_range(

tests/unit/timing/test_time_based_timing.py::TestTimeBasedTiming::test_get_rebalance_dates_annual
  C:\Users\Mateusz\source\repos\portfolio-backtester\src\portfolio_backtester\timing\time_based_timing.py:39: FutureWarning: 'A' is deprecated and will be removed in a future version, please use 'YE' instead.
    rebalance_dates = pd.bdate_range(

tests/unit/timing/test_time_based_timing.py::TestTimeBasedTiming::test_case_insensitive_frequency
  C:\Users\Mateusz\source\repos\portfolio-backtester\src\portfolio_backtester\timing\time_based_timing.py:39: FutureWarning: 'm' is deprecated and will be removed in a future version, please use 'ME' instead.
    rebalance_dates = pd.bdate_range(

-- Docs: https://docs.pytest.org/en/stable/how-to/capture-warnings.html
============================ slowest 25 durations =============================
31.95s call     tests/unit/optimizer/test_dummy_strategy_optimizer.py::test_dummy_strategy_single_trial_optimizer
2.93s call     tests/integration/backtester/test_simple_integration.py::TestSimpleIntegration::test_end_to_end_workflow_smoke
1.93s call     tests/integration/optimization/test_performance_regression.py::TestPerformanceRegression::test_scalability_with_evaluation_count
1.71s call     tests/integration/strategies/test_dummy_meta_strategy_integration.py::test_dummy_meta_strategy_end_to_end
1.68s call     tests/integration/optimization/test_performance_regression.py::TestPerformanceRegression::test_memory_usage_stability
1.42s call     tests/integration/strategies/test_dummy_strategy_integration.py::test_dummy_strategy_end_to_end

(19 durations < 1s hidden.)
=========================== short test summary info ===========================
FAILED tests/integration/test_intramonth_strategy_integration.py::TestIntramonthStrategyIntegration::test_backward_compatibility_with_monthly_strategies
FAILED tests/integration/test_intramonth_strategy_integration.py::TestIntramonthStrategyIntegration::test_daily_vs_monthly_evaluation_comparison
FAILED tests/integration/test_schedule_independent_stop_loss.py::TestStopLossErrorHandling::test_stop_loss_handler_failure_graceful_degradation
FAILED tests/unit/backtesting/test_window_evaluator_stop_loss_integration.py::TestWindowEvaluatorStopLossIntegration::test_stop_loss_signals_applied_to_position_tracker
FAILED tests/unit/backtesting/test_window_evaluator_stop_loss_integration.py::TestWindowEvaluatorStopLossIntegration::test_stop_loss_error_handling_continues_evaluation
FAILED tests/unit/backtesting/test_window_evaluator_stop_loss_integration.py::TestWindowEvaluatorStopLossIntegration::test_empty_stop_loss_signals_handled_correctly
FAILED tests/unit/backtesting/test_window_evaluator_stop_loss_integration.py::TestWindowEvaluatorStopLossIntegration::test_multiple_stop_loss_signals_same_day
FAILED tests/unit/timing/test_consolidated_compatibility.py::TestTimingFrameworkCompatibility::test_explicit_time_based_timing_configuration
FAILED tests/unit/timing/test_time_based_timing.py::TestTimeBasedTiming::test_initialization_custom_config
FAILED tests/unit/timing/test_time_based_timing.py::TestTimeBasedTiming::test_get_rebalance_dates_quarterly
FAILED tests/unit/timing/test_time_based_timing.py::TestTimeBasedTiming::test_get_rebalance_dates_daily
FAILED tests/unit/timing/test_time_based_timing.py::TestTimeBasedTiming::test_get_rebalance_dates_weekend_adjustment
FAILED tests/unit/timing/test_time_based_timing.py::TestTimeBasedTiming::test_other_frequencies_unchanged
FAILED tests/unit/timing/test_time_based_timing.py::TestTimeBasedTiming::test_get_rebalance_dates_annual
FAILED tests/unit/timing/test_time_based_timing.py::TestTimeBasedTiming::test_get_rebalance_dates_invalid_frequency
FAILED tests/unit/timing/test_time_based_timing.py::TestTimeBasedTiming::test_get_rebalance_dates_single_available_date
= 16 failed, 1279 passed, 6 skipped, 96 deselected, 15 warnings in 60.10s (0:01:00) =
